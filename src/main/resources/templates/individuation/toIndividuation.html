<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
    <title> 定制服务</title>
    <div th:replace="../templates/publicContent/commen :: commenhead"></div>
    <link rel="stylesheet" type="text/css" th:href="@{/css/confession/toConfession.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/individuation/individuation.css}" />

    <style type="text/css">

        .backcolor{
            background-color: rgba(128, 131, 136, 0.65);

        }

    </style>
</head>
<body class="scrollingBackgroundimg">

<div class="maindiv1">
    <div th:replace="../templates/publicContent/headImg :: headImg"></div>
</div>



<div class="maindiv2 ">
    <div align="center">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;width: 80%">
        </fieldset>

            <div style="margin: 10px">此服务为收费服务</div>
            <button class="chargingStandard layui-btn layui-btn-primary layui-btn-radius">查看超便宜的收费标准</button>

        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;width: 80%">
        </fieldset>
    </div>



    <div style="width: 100%;height: 100%;position: absolute" align="center" >

        <form method="post"  class="feelingform layui-form">
            <div class="" style="width: 80%;margin-top: 5% ">
                <div class="inputtextdiv" style="display: inline-block;height: 50px;width: 50%">
                    <input type="text" name="receiver" lay-verify="required|inputlimit" lay-vertype="tips" style=" border-radius: 15px;"  placeholder="他会根据这条信息搜索到你留下的话" autocomplete="off" class="layui-input receiver" />
                </div>
            </div>

            <div class="" style="width: 80%;">
                <div class="inputtextdiv" style="display: inline-block;height: 200px;width: 50%;margin-top: 20px">
                    <textarea type="text" name="content" style=" border-radius: 15px;height: 200px;width: 100%" lay-vertype="tips" lay-verify="required|textarealimit" placeholder="对Ta说点什么" autocomplete="off" class="content" ></textarea>
                </div>
            </div>

            <div class="" style="width: 80%;">
                <div class="inputtextdiv" style="display: inline-block;height: 50px;width: 50%;margin-top: 20px">
                    <input type="text" name="clue" style=" border-radius: 15px;" lay-verify="required|inputlimit" lay-vertype="tips" placeholder="留下你的一些信息，如果想让Ta猜到你的话" autocomplete="off" class="layui-input clue" />
                </div>
            </div>


            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 100px;">
                <legend>选择保存时间</legend>
            </fieldset>

            <div class="" style="width: 80%;color: black">
                <div class="inputtextdiv" style="display: inline-block;height: 50px;width: 50%;margin-top: 20px">
                    <select name="effectiveTime" lay-verify="required">
                        <option value=""></option>
                        <option value="7">一周</option>
                        <option value="30">一个月</option>
                        <option value="365">一年</option>
                    </select>
                </div>
            </div>

<div class="inputtextdiv" style="margin-top: 40px">
    <div style="display: inline-block;width: 24%;">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>进场动画</legend>
            </fieldset>
    </div>
    <div style="display: inline-block;width: 24%;">
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
        <legend>轮播图片</legend>
    </fieldset>
    </div>
    <div style="display: inline-block;width: 24%;">
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
        <legend>特效动画</legend>
    </fieldset>
    </div>
    <div style="display: inline-block;width: 24%;">
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
        <legend>背景音乐</legend>
    </fieldset>
    </div>
</div>
            <div class="inputtextdiv">
                <div style="display: inline-block;width: 24%;"><input type="checkbox"  lay-filter="checktype"  checktype="1"  class="approachAnimationSwitch" name="approachAnimationSwitch" lay-skin="switch" lay-text="开启|关闭"></div>
                <div style="display: inline-block;width: 24%;"><input type="checkbox"  lay-filter="checktype"  checktype="2"  class="backgroundEffectSwitch" name="backgroundEffectSwitch" lay-skin="switch" lay-text="开启|关闭"></div>
                <div style="display: inline-block;width: 24%;"><input type="checkbox"  lay-filter="checktype"  checktype="3"  class="dropEffectSwitch" name="dropEffectSwitch" lay-skin="switch" lay-text="开启|关闭"></div>
                <div style="display: inline-block;width: 24%;"><input type="checkbox"  lay-filter="checktype"  checktype="4"  class="musicSwitch" name="musicSwitch" lay-skin="switch" lay-text="开启|关闭"></div>
            </div>


          <div class="checktype2" style="width: auto;height: auto;display: none">

            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 40px;">
                <legend>轮播图片上传</legend>
            </fieldset>


            <div class="" style="width: 80%;">
                <div class="inputtextdiv" style="display: inline-block;height: 50px;width: 50%;margin-top: 20px;color: black">
                    <div style="display: inline-block;width: 50%;">
                        <input type="button" class="backcolor singleImgButton layui-btn layui-btn-primary layui-btn-radius" value="前置轮播图" />
                    </div>
                    <div  style="display: inline-block;width: 45%;">
                        <input type="button" class="rollImgButton layui-btn layui-btn-primary layui-btn-radius" value="全屏轮播图"/>
                    </div>
                    </div>
            </div>

            <div class="" style="width: 80%;position: relative;margin-top: 30px">
                <div style="display: inline-block;height: 50px;width: 100%">

                    <div class="layui-upload rollImg">
                        <button type="button" class="layui-btn layui-btn-radius layui-btn-primary" id="upImgbutton">前置上传</button>
                        <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
                            预览图：
                            <div class="layui-upload-list" id="previewimg" style="min-height: 40px;object-fit: contain;width: auto;height: auto"></div>
                        </blockquote>
                    </div>

                </div>
            </div>
              <button type="button" style="display: inline-block;margin-top: 100px" class="layui-btn layui-btn-radius layui-btn-primary" id="submitrollimg">开始上传</button>
          </div>



        <div class="checktype3" style="width: auto;height: auto;display: none">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 100px;">
                <legend>特效</legend>
            </fieldset>


            <div class="" style="width: 80%;">
                <div class="inputtextdiv" style="display: inline-block;height: 100px;width: 80%;margin-top: 20px">
                    <div>
                        <input type="radio" name="dropEffectType" checked value="1" title="特效一">
                        <input type="radio" name="dropEffectType" value="2" title="特效二">
                        <input type="radio" name="dropEffectType" value="3" title="特效三">
                    </div>

                </div>
            </div>
        </div>



            <div class="checktype4" style="width: auto;height: auto;display: none">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 100px;">
                <legend>背景音乐(不上传将使用随机系统内置音乐)</legend>
            </fieldset>


            <div class="" style="width: 80%;position: relative;margin-top: 20px">
                <div style="display: inline-block;height: 50px;width: 50%">

                    <div class="layui-upload-drag" id="musuploaddiv">
                        <i class="layui-icon"></i>
                        <p>点击上传，或将文件拖拽到此处</p>
                        <div class="layui-hide" id="uploadshowname">
                            <hr>
                            <span class="showname"></span>

                        </div>
                    </div>


                </div>
            </div>
            </div>






            <div class="" style="width: 80%;margin-top: 90px;position: relative">
                <div style="display: inline-block;height: 200px;width: 50%;margin-top: 20px">
                    <input type="button" name="update" value="上传" lay-submit lay-filter="laysubmitbutton" class="submitbutton layui-btn layui-btn-radius layui-btn-primary">
                </div>
            </div>


            <input type="hidden" name="cyclicDisplayImgList" class="cyclicDisplayImgList"/>
            <input type="hidden" name="musicPath" class="musicPath"  />
            <input type="hidden" name="rollImgType" class="rollImgType" value="1"/>
        </form>

    </div>


</div>



<div class="maindiv3">
    <div th:replace="../templates/publicContent/menubar :: menubar"></div>
</div>


<div class="pop-up">
    <div class="content">
        <div class="container">

            <span class="close">close</span>

            <div class="chargingStandard" align="center" >
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;width: 80%">
                    <legend>月费</legend>
                </fieldset>
                <div>
                    10元/月/个(页面)，过期自动转为普通页面。
                </div>
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;width: 80%">
                    <legend>年费</legend>
                </fieldset>
                <div>
                    100元/年/个(页面)，过期自动转为普通页面。
                </div>
                <div style="margin-top: 10%">
                    首次充值便激活本网站永久VIP，享受个性化服务。
                </div>
            </div>
        </div>
    </div>
</div>

<script>


    $(".singleImgButton").click(function () {
        $(".rollImgButton").removeClass("backcolor");
        $(this).addClass("backcolor");
        $("#upImgbutton").text("前置轮播图上传");
        $(".rollImgType").val("1");

    });

    $(".rollImgButton").click(function () {
        $(".singleImgButton").removeClass("backcolor");
        $(this).addClass("backcolor");
        $("#upImgbutton").text("全屏轮播图上传");
        $(".rollImgType").val("2");
    });

    $('.chargingStandard').click(function(){
        //$('.pop-up').show();
        $('.pop-up').addClass('open');
    });

    $('.pop-up .close').click(function(){
        $('.pop-up').removeClass('open');
    });



layui.use(['layer','form','upload'], function() {
        var layer = layui.layer //弹层
            ,upload = layui.upload //上传
            , form = layui.form



        form.on('switch(checktype)',function (data) {
        let type=this.getAttribute("checktype");

            if (type==2 && data.elem.checked) {
                $(".checktype2").show();
                $(".cyclicDisplayImgList").attr("lay-verify","required");
                $(".cyclicDisplayImgList").attr("lay-reqtext","图片忘记上传了哦");

                }else if (type==2 && !data.elem.checked){
                    $(".checktype2").hide();
                    $(".cyclicDisplayImgList").attr("lay-verify","");
                    $(".cyclicDisplayImgList").attr("lay-reqtext","");
                    }else if (type==3 && data.elem.checked) {
                        $(".checktype3").show();
                        }else if (type==3 && !data.elem.checked){
                            $(".checktype3").hide();
                             } else if (type==4 && data.elem.checked) {
                                $(".checktype4").show();
                                $(".musicPath").attr("lay-verify","required");
                                $(".musicPath").attr("lay-reqtext","音乐还没有上传呢");
                                }else if (type==4 && !data.elem.checked){
                                    $(".checktype4").hide();
                                    $(".musicPath").attr("lay-verify","");
                                    $(".musicPath").attr("lay-reqtext","");
                                    }
        });


/*
        $(".chargingStandard").click(function () {
            layer.open({
                type: 2,
                title: ['超便宜的收费标准', 'font-size:18px;'],
                content: '/individuation/chargingStandard',//这里content是一个URL，如果你不想让iframe出现滚动条，你还可以content: ['http://sentsin.com', 'no']
                area: ['500px', '300px'],
                resize:false,
                scrollbar: false

            });
        });*/



        form.verify({
            inputlimit: function(value){

                if (value.length>30){
                    return '太长啦';
                }
            }
            ,textarealimit: function(value){
                if(value.length < 5){
                    return '太少啦';
                }
                if (value.length>500){
                    return '如果有太多的话建议当面说哦';
                }
            }
            ,pass: [
                /^[\S]{6,12}$/
                ,'密码必须6到12位，且不能出现空格'
            ]
            /*            ,content: function(value){
                            layedit.sync(editIndex);
                        }*/
        });

        form.on('submit()', function(data) {

            ajaxForForm("submitbutton", "post", "/individuation/saveIndividuation", "feelingform", true);
        });

        /*音乐上传*/
        upload.render({
            elem: '#musuploaddiv'
            ,accept: 'audio' //音频
            ,exts: 'mp3|aac|flac|ram|ape' //格式
            ,url: '/fileService/uploadMediaFileUtil'
            ,field:'mediaFile'
            ,size:10000
            ,headers:{"X-CSRF-TOKEN":tokenparam}
            /*            ,auto:false
                        ,bindAction:'.submitbutton'*/
            ,before: function(obj){ //obj参数包含的信息，跟 choose回调完全一致
                obj.preview(function(index, file, result){

                    layui.$('#uploadshowname').removeClass('layui-hide').find('span').text(file.name);

                });

            }
            ,done: function(res){
                $(".musicPath").val(res.individuationMessage);
                layer.msg(res.information);
                //layui.$('#uploadshowname').removeClass('layui-hide').find('span').text("111");

            }
            ,error:function (res) {
                layer.msg(res.information)
            }
        });



/*    var elems=!$("form").find("input").not("readonly");
    if (!checkResult(elems)){

        return;
    }*/


    /*上传前序号*/
    var indexnumber=0;
    /*上传完成编号*/
    var imglistindex=0;
    /*存所有图片名称的对象*/
    var cyclic_Display_ImgList={};

        //多图片上传
        var uploadreture= upload.render({
            elem: '#upImgbutton'
            ,url: '/confession/uploadPicture' //改成您自己的上传接口
            ,multiple: true
            ,auto: false //选择文件后不自动上传
            ,number:8
            ,field:'background'
            ,bindAction: '#submitrollimg' //指向一个按钮触发上传
            ,data: {id: function () {
                    return indexnumber++;
                }}
            ,headers:{"X-CSRF-TOKEN":tokenparam}
            ,choose: function(obj){
                //将每次选择的文件追加到文件队列
                var files = obj.pushFile();

                //预读本地文件，如果是多文件，则会遍历。(不支持ie8/9)
                obj.preview(function(index, file, result){

                    console.log(index); //得到文件索引
/*
                    console.log(file); //得到文件对象
                    console.log(result); //得到文件base64编码，比如图片
*/

                    if (getJsonLength(files)>8){
                        layer.msg("最多上传8张图片！");
                        delete files[index];
                        return;
                    }

                    var priviewimg=$('<div style="display: inline-block;position: relative"><img style="object-fit: contain;height: 90px;position: relative" src="'+ result +'" alt="'+ file.name +'" class="layui-upload-img"><input type="button" class="deletebutton layui-btn layui-btn-primary layui-btn-radius" style="position: absolute;left: 0px" value="删除"/></div>');

                    priviewimg.find(".deletebutton").on('click',function () {
                        delete files[index]; //删除对应的文件
                        priviewimg.remove();
                        uploadreture.config.elem.next()[0].value = ''; //清空 input file 值，以免删除后出现同名文件不可选
                    });

                    $('#previewimg').append(priviewimg);
                    //obj.resetFile(index, file, '123.jpg'); //重命名文件名

                });
            }

            ,done: function(res){

                if (res.statusCode==200) {
                    /*如果上传成功取出文件名存在cyclic_Display_ImgList中，imglistindex变量每次加一*/
                    cyclic_Display_ImgList[imglistindex] = res.individuationMessage;
                }
                imglistindex++;
            }


            ,allDone: function(obj){ //当文件全部被提交后，才触发
                console.log(obj.total); //得到总文件数
                console.log(obj.successful); //请求成功的文件数
                console.log(obj.aborted); //请求失败的文件数
                if (obj.successful==obj.total){

                    layer.msg("全部上传成功");
                } else {
                    layer.msg("发生错误请重新上传！");

                }
                indexnumber=0;
                $(".cyclicDisplayImgList").val(JSON.stringify(cyclic_Display_ImgList));
            }

        });

    });


</script>

</body>
</html>